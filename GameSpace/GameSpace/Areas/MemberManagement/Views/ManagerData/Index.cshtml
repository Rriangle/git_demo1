@model IEnumerable<GameSpace.Areas.MemberManagement.Models.ManagerDatumVM>

@{
    ViewData["Title"] = "管理者資訊";

    // 由 Controller 的 ViewBag 帶入目前的查詢/排序狀態
    int? currentId = ViewBag.ManagerId as int?;
    string currentName = ViewBag.ManagerName as string;
    string sortBy = (ViewBag.SortBy as string) ?? "id";      // id | date
    string sortDir = (ViewBag.SortDir as string) ?? "asc";   // asc | desc

    // 計算下一次點擊時的排序方向（同欄位切換方向、換欄位預設升冪）
    string nextIdDir = (sortBy == "id" && sortDir == "asc") ? "desc" : "asc";
    string nextDateDir = (sortBy == "date" && sortDir == "asc") ? "desc" : "asc";

    var idArrow = sortBy == "id" ? (sortDir == "asc" ? "▲" : "▼") : "";
    var dateArrow = sortBy == "date" ? (sortDir == "asc" ? "▲" : "▼") : "";

    // ★ 保留側欄狀態（預設 admin）
    var sidebar = (string)(ViewBag.Sidebar ?? Context.Request.Query["sidebar"].ToString() ?? "admin");
}

<h1 class="d-flex align-items-center gap-3">@ViewData["Title"]</h1>

<!-- 搜尋表單（GET） -->
<form method="get" class="mb-3">
    <div class="row g-2 align-items-end">
        <div class="col-auto">
            <label for="managerId" class="form-label">管理者編號</label>
            <input id="managerId" name="managerId" type="number" class="form-control"
                   value="@(currentId?.ToString() ?? "")" placeholder="例如：10000001" />
        </div>
        <div class="col-auto">
            <label for="managerName" class="form-label">管理者姓名</label>
            <input id="managerName" name="managerName" type="text" class="form-control"
                   value="@(currentName ?? "")" placeholder="關鍵字" />
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">搜尋</button>
            <a asp-action="Index"
               asp-route-sidebar="@sidebar"
               class="btn btn-outline-secondary">清除</a>
        </div>
    </div>

    @* 搜尋時保留目前排序與側欄 *@
    <input type="hidden" name="sortBy" value="@sortBy" />
    <input type="hidden" name="sortDir" value="@sortDir" />
    <input type="hidden" name="sidebar" value="@sidebar" />
</form>

<table class="table table-striped table-hover align-middle">
    <thead>
        <tr>
            <th>
                <a asp-action="Index"
                   asp-route-managerId="@(currentId?.ToString())"
                   asp-route-managerName="@currentName"
                   asp-route-sortBy="id"
                   asp-route-sortDir="@nextIdDir"
                   asp-route-sidebar="@sidebar">
                    管理者編號 @idArrow
                </a>
            </th>
            <th>管理者姓名</th>
            <th>管理者帳號</th>
            <th>管理者信箱</th>
            <th>
                <a asp-action="Index"
                   asp-route-managerId="@(currentId?.ToString())"
                   asp-route-managerName="@currentName"
                   asp-route-sortBy="date"
                   asp-route-sortDir="@nextDateDir"
                   asp-route-sidebar="@sidebar">
                    註冊日期 @dateArrow
                </a>
            </th>
        </tr>
    </thead>
    <tbody>
        @if (!Model.Any())
        {
            <tr><td colspan="5" class="text-center text-muted">沒有符合條件的資料</td></tr>
        }
        else
        {
            foreach (var item in Model)
            {
                <tr>
                    <td>@item.ManagerId</td>
                    <td>@item.ManagerName</td>
                    <td>@item.ManagerAccount</td>
                    <td>@item.ManagerEmail</td>
                    <td>@item.AdministratorRegistrationDate</td>
                </tr>
            }
        }
    </tbody>
</table>
